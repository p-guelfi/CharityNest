<h1><%= @discussion.title %></h1>
<p><%= @discussion.description %></p>

<!-- Delete Discussion button -->
<% if @discussion.user == current_user %>
  <%= form_with url: donation_discussion_path(@donation, @discussion), method: :delete, local: true, data: { confirm: 'Are you sure you want to delete this discussion?' }, class: 'inline-form' do %>
    <%= submit_tag 'Delete Discussion', class: 'btn btn-danger' %>
  <% end %>
<% end %>

<h2>Comments</h2>
<div class="comments-list">
  <% @discussion.comments.each do |comment| %>
    <div class="comment-card">
      <p><%= comment.content %></p>
      <small>by <%= comment.user&.email || 'Anonymous' %></small>

      <% if comment.user == current_user %>
        <%= form_with url: donation_discussion_comment_path(@donation, @discussion, comment), method: :delete, local: true, data: { confirm: 'Are you sure you want to delete this comment?' }, class: 'inline-form' do %>
          <%= submit_tag 'Delete', class: 'btn btn-danger' %>
        <% end %>
      <% end %>
    </div>
  <% end %>
</div>

<h3>New Comment</h3>
<%= form_with model: [@donation, @discussion, @discussion.comments.build], local: true do |f| %>
  <div class="form-group">
    <%= f.label :content, "Your Comment" %>
    <%= f.text_area :content, rows: 3, class: "form-control" %>
  </div>
  <%= f.submit "Add Comment", class: "btn btn-primary" %>
<% end %>
